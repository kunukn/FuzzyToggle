{"version":3,"file":"FuzzyToggle.umd.es2015.js","sources":["../src/FuzzyToggle/createToggle.js"],"sourcesContent":["// Support browser or node env\r\nconst root = typeof window !== 'undefined' ? window : global;\r\nconst rAF = root.requestAnimationFrame\r\n  ? root.requestAnimationFrame.bind(root)\r\n  : callback => root.setTimeout(callback, 16);\r\nconst cAF = root.cancelAnimationFrame ? root.cancelAnimationFrame.bind(root) : root.clearInterval.bind(root);\r\n\r\nconst clamp = (value, min, max) => Math.min(Math.max(value, min), max);\r\nconst sanitizeVal = value => clamp(Math.round((value + 0.00001) * 100) / 100, 0, 1); // https://stackoverflow.com/a/11832950/815507\r\n\r\nconst COLLAPSED = 'collapsed';\r\nconst EXPANDED = 'expanded';\r\nconst EXPANDING = 'expanding';\r\nconst COLLAPSING = 'collapsing';\r\n\r\nconst getNow = Date.now;\r\n\r\nconst defaultParams = {\r\n  value: 0,\r\n  duration: 300,\r\n  trace: () => {}\r\n};\r\n\r\nlet isMoving = motion => motion === EXPANDING || motion === COLLAPSING;\r\nlet isCollapsedOrCollapsing = motion => motion === COLLAPSED || motion === COLLAPSING;\r\n\r\nlet initiateStateAndConfig = (params = {}) => {\r\n  let config = {\r\n    ...defaultParams,\r\n    ...params\r\n  };\r\n  config.duration = +config.duration;\r\n\r\n  let state = {\r\n    value: config.value === 1 ? 1 : 0,\r\n    motion: config.value === 1 ? EXPANDED : COLLAPSED,\r\n    cancelled: false,\r\n    isRunning: false,\r\n    startTime: 0\r\n  };\r\n  return [config, state];\r\n};\r\n\r\nfunction createToggle(params) {\r\n  let [config, state] = initiateStateAndConfig(params);\r\n\r\n  let getConfig = () => {\r\n    config.trace('getConfig');\r\n\r\n    let { duration, value } = config;\r\n\r\n    return {\r\n      duration,\r\n      value\r\n    };\r\n  };\r\n\r\n  let setConfig = params => {\r\n    config.trace('setConfig');\r\n\r\n    if (state.isRunning) return;\r\n\r\n    let [updatedConfig, updatedState] = initiateStateAndConfig(params);\r\n\r\n    config = updatedConfig;\r\n    state = updatedState;\r\n\r\n    return true;\r\n  };\r\n\r\n  let onUpdate = () => {\r\n    config.onUpdate && config.onUpdate({ value: state.value, motion: state.motion });\r\n  };\r\n\r\n  let getUpdate = () => {\r\n    let elapsedTime = getNow() - state.startTime;\r\n    let value = elapsedTime / config.duration;\r\n\r\n    value = sanitizeVal(isCollapsedOrCollapsing(state.motion) ? 1 - value : value);\r\n\r\n    let result = {\r\n      elapsedTime,\r\n      prevValue: state.value,\r\n      value\r\n    };\r\n    return result;\r\n  };\r\n\r\n  let run = () => {\r\n    if (state.cancelled) return;\r\n\r\n    let { value, prevValue, elapsedTime } = getUpdate();\r\n\r\n    // update\r\n    state.value = value;\r\n    state.elapsedTime = elapsedTime;\r\n\r\n    if (elapsedTime >= config.duration) {\r\n      state.motion = isCollapsedOrCollapsing(state.motion) ? COLLAPSED : EXPANDED;\r\n      state.isRunning = false;\r\n      state.cAF = null;\r\n\r\n      if (prevValue !== value) onUpdate();\r\n\r\n      config.onDone && config.onDone({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\r\n    } else {\r\n      onUpdate();\r\n      state.cAF = rAF(run);\r\n    }\r\n  };\r\n\r\n  let toggle = () => {\r\n    if (config.duration <= 0) return;\r\n\r\n    state.cancelled = false;\r\n    state.isRunning = true;\r\n    state.hasReversed = isMoving(state.motion);\r\n    state.motion = isCollapsedOrCollapsing(state.motion) ? EXPANDING : COLLAPSING;\r\n\r\n    config.onToggle && config.onToggle({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\r\n\r\n    let now = getNow();\r\n\r\n    // update startTime\r\n    if (state.hasReversed) {\r\n      let { duration } = config;\r\n      let { startTime } = state;\r\n      let elapsedTime = Math.min(duration, now - startTime);\r\n      let subtract = Math.max(0, duration - elapsedTime);\r\n      state.startTime = now - subtract;\r\n    } else {\r\n      state.startTime = now;\r\n    }\r\n\r\n    onUpdate();\r\n    state.cAF = rAF(run);\r\n    return true;\r\n  };\r\n\r\n  let cancel = () => {\r\n    config.trace('cancel');\r\n\r\n    if (!state.isRunning) return;\r\n\r\n    state.cAF && cAF(state.cAF);\r\n\r\n    state.isRunning = false;\r\n\r\n    let motion = state.motion === EXPANDING ? COLLAPSED : EXPANDED;\r\n\r\n    state.motion = motion;\r\n    state.value = motion === COLLAPSED ? 0 : 1;\r\n    state.cancelled = true;\r\n\r\n    config.onCancel && config.onCancel({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\r\n    return true;\r\n  };\r\n\r\n  return { toggle, cancel };\r\n}\r\n\r\nexport default createToggle;\r\n"],"names":["root","window","global","rAF","requestAnimationFrame","bind","callback","setTimeout","cAF","cancelAnimationFrame","clearInterval","sanitizeVal","value","min","max","Math","clamp","round","COLLAPSED","EXPANDED","EXPANDING","COLLAPSING","getNow","Date","now","defaultParams","duration","trace","isMoving","motion","isCollapsedOrCollapsing","initiateStateAndConfig","params","config","cancelled","isRunning","startTime","state","onUpdate","run","prevValue","elapsedTime","getUpdate","onDone","hasReversed","toggle","onToggle","subtract","cancel","onCancel"],"mappings":"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"}