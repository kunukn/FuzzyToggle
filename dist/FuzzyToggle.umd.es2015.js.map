{"version":3,"file":"FuzzyToggle.umd.es2015.js","sources":["../src/FuzzyToggle/createToggle.js"],"sourcesContent":["// Support browser or node env\r\nconst root = typeof window !== 'undefined' ? window : global;\r\nconst rAF = root.requestAnimationFrame\r\n  ? root.requestAnimationFrame.bind(root)\r\n  : callback => root.setTimeout(callback, 16);\r\nconst cAF = root.cancelAnimationFrame ? root.cancelAnimationFrame.bind(root) : root.clearInterval.bind(root);\r\n\r\nconst clamp = (value, min, max) => Math.min(Math.max(value, min), max);\r\nconst sanitizeVal = value => clamp(Math.round((value + 0.00001) * 100) / 100, 0, 1); // https://stackoverflow.com/a/11832950/815507\r\n\r\nconst COLLAPSED = 'collapsed';\r\nconst EXPANDED = 'expanded';\r\nconst EXPANDING = 'expanding';\r\nconst COLLAPSING = 'collapsing';\r\n\r\nconst getNow = Date.now;\r\n\r\nconst defaultParams = {\r\n  value: 0,\r\n  duration: 300,\r\n  trace: () => {}\r\n};\r\n\r\nlet isMoving = motion => motion === EXPANDING || motion === COLLAPSING;\r\nlet isCollapsedOrCollapsing = motion => motion === COLLAPSED || motion === COLLAPSING;\r\n\r\nlet initiateStateAndConfig = (params = {}) => {\r\n  let config = {\r\n    ...defaultParams,\r\n    ...params\r\n  };\r\n  config.duration = +config.duration;\r\n\r\n  let state = {\r\n    value: config.value === 1 ? 1 : 0,\r\n    motion: config.value === 1 ? EXPANDED : COLLAPSED,\r\n    cancelled: false,\r\n    isRunning: false,\r\n    startTime: getNow()\r\n  };\r\n  return [config, state];\r\n};\r\n\r\nfunction createToggle(params) {\r\n  let [config, state] = initiateStateAndConfig(params);\r\n\r\n  let getConfig = () => {\r\n    config.trace('getConfig');\r\n\r\n    let {duration, value} = config;\r\n\r\n    return {\r\n      duration, value\r\n    };\r\n  };\r\n\r\n  let setConfig = params => {\r\n    config.trace('setConfig');\r\n\r\n    if (state.isRunning) return;\r\n\r\n    let [updatedConfig, updatedState] = initiateStateAndConfig(params);\r\n\r\n    config = updatedConfig;\r\n    state = updatedState;\r\n\r\n    return true;\r\n  };\r\n\r\n  let onDone = () => {\r\n    config.trace('onDone');\r\n\r\n    if (config.onDone) {\r\n      let { value, motion, hasReversed } = state;\r\n      config.onDone({ value, motion, hasReversed });\r\n    }\r\n  };\r\n\r\n  let onUpdate = () => {\r\n    config.trace('onUpdate');\r\n\r\n    if (config.onUpdate) {\r\n      let { value, motion, hasReversed } = state;\r\n\r\n      config.onUpdate({ value, motion, hasReversed });\r\n    }\r\n  };\r\n\r\n  let onCancel = () => {\r\n    config.trace('onCancel');\r\n\r\n    if (config.onCancel) {\r\n      let { value, motion, hasReversed } = state;\r\n\r\n      config.onCancel({ value, motion, hasReversed });\r\n    }\r\n  };\r\n\r\n  let onReverse = () => {\r\n    config.trace('onReverse');\r\n\r\n    if (config.onReverse) {\r\n      let { value, motion } = state;\r\n\r\n      config.onReverse({ value, motion });\r\n    }\r\n  };\r\n\r\n  let getUpdate = () => {\r\n    let elapsedTime = getNow() - state.startTime;\r\n    let value = elapsedTime / config.duration;\r\n\r\n    value = sanitizeVal(isCollapsedOrCollapsing(state.motion) ? 1 - value : value);\r\n\r\n    let result = {\r\n      elapsedTime,\r\n      prevValue: state.value,\r\n      value\r\n    };\r\n    return result;\r\n  };\r\n\r\n  let run = () => {\r\n    if (state.cancelled) return;\r\n\r\n    let { value, prevValue, elapsedTime } = getUpdate();\r\n\r\n    // update\r\n    state.value = value;\r\n    state.elapsedTime = elapsedTime;\r\n\r\n    if (elapsedTime >= config.duration) {\r\n      if (prevValue !== value) onUpdate();\r\n\r\n      state.motion = isCollapsedOrCollapsing(state.motion) ? COLLAPSED : EXPANDED;\r\n      state.isRunning = false;\r\n      state.cAF = null;\r\n      onDone();\r\n    } else {\r\n      onUpdate();\r\n      state.cAF = rAF(run);\r\n    }\r\n  };\r\n\r\n  let toggle = () => {\r\n    config.trace('toggle');\r\n\r\n    if (config.duration <= 0) return;\r\n\r\n    state.cancelled = false;\r\n    state.isRunning = true;\r\n    state.hasReversed = isMoving(state.motion);\r\n    state.motion = isCollapsedOrCollapsing(state.motion) ? EXPANDING : COLLAPSING;\r\n\r\n    state.hasReversed && onReverse();\r\n\r\n    let now = getNow();\r\n\r\n    // update startTime\r\n    if (state.hasReversed) {\r\n      let { duration } = config;\r\n      let { startTime } = state;\r\n      let elapsedTime = Math.min(duration, now - startTime);\r\n      let subtract = Math.max(0, duration - elapsedTime);\r\n      state.startTime = now - subtract;\r\n    } else {\r\n      state.startTime = now;\r\n    }\r\n\r\n    onUpdate();\r\n    state.cAF = rAF(run);\r\n    return true;\r\n  };\r\n\r\n  let cancel = () => {\r\n    config.trace('cancel');\r\n\r\n    if (!state.isRunning) return;\r\n\r\n    state.cAF && cAF(state.cAF);\r\n\r\n    state.isRunning = false;\r\n\r\n    let motion = state.motion === EXPANDING ? COLLAPSED : EXPANDED;\r\n\r\n    state.motion = motion;\r\n    state.value = motion === COLLAPSED ? 0 : 1;\r\n    state.cancelled = true;\r\n\r\n    onCancel();\r\n    return true;\r\n  };\r\n\r\n  return { toggle, cancel, getConfig, setConfig };\r\n}\r\n\r\nexport default createToggle;\r\n"],"names":["root","window","global","rAF","requestAnimationFrame","bind","callback","setTimeout","cAF","cancelAnimationFrame","clearInterval","sanitizeVal","value","min","max","Math","clamp","round","COLLAPSED","EXPANDED","EXPANDING","COLLAPSING","getNow","Date","now","defaultParams","duration","trace","isMoving","motion","isCollapsedOrCollapsing","initiateStateAndConfig","params","config","cancelled","isRunning","startTime","state","onUpdate","hasReversed","run","prevValue","elapsedTime","getUpdate","onDone","toggle","onReverse","subtract","cancel","onCancel","getConfig","setConfig","updatedConfig","updatedState"],"mappings":"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"}