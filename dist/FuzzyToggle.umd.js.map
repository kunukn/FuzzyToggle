{"version":3,"file":"FuzzyToggle.umd.js","sources":["../src/FuzzyToggle/createToggle.js"],"sourcesContent":["// Support browser or node env\nconst root = typeof window !== 'undefined' ? window : global;\nconst rAF = root.requestAnimationFrame\n  ? root.requestAnimationFrame.bind(root)\n  : callback => root.setTimeout(callback, 16);\nconst cAF = root.cancelAnimationFrame ? root.cancelAnimationFrame.bind(root) : root.clearInterval.bind(root);\n\nconst clamp = (value, min, max) => Math.min(Math.max(value, min), max);\nconst sanitizeVal = value => clamp(Math.round((value + 0.00001) * 100) / 100, 0, 1); // https://stackoverflow.com/a/11832950/815507\n\nconst COLLAPSED = 'collapsed';\nconst EXPANDED = 'expanded';\nconst EXPANDING = 'expanding';\nconst COLLAPSING = 'collapsing';\n\nconst getNow = Date.now;\n\nconst defaultParams = {\n  value: 0,\n  duration: 300,\n  trace: () => {}\n};\n\nlet isMoving = motion => motion === EXPANDING || motion === COLLAPSING;\nlet isCollapsedOrCollapsing = motion => motion === COLLAPSED || motion === COLLAPSING;\n\nlet initiateStateAndConfig = (params = {}) => {\n  let config = {\n    ...defaultParams,\n    ...params\n  };\n  config.duration = +config.duration;\n\n  let state = {\n    value: config.value === 1 ? 1 : 0,\n    motion: config.value === 1 ? EXPANDED : COLLAPSED,\n    cancelled: false,\n    isRunning: false,\n    startTime: 0\n  };\n  return [config, state];\n};\n\nfunction createToggle(params) {\n  let [config, state] = initiateStateAndConfig(params);\n\n  let getConfig = () => {\n    config.trace('getConfig');\n\n    let { duration, value } = config;\n\n    return {\n      duration,\n      value\n    };\n  };\n\n  let setConfig = params => {\n    config.trace('setConfig');\n\n    if (state.isRunning) return;\n\n    let [updatedConfig, updatedState] = initiateStateAndConfig(params);\n\n    config = updatedConfig;\n    state = updatedState;\n\n    return true;\n  };\n\n  let onUpdate = () => {\n    config.onUpdate && config.onUpdate({ value: state.value, motion: state.motion });\n  };\n\n  let getUpdate = () => {\n    let elapsedTime = getNow() - state.startTime;\n    let value = elapsedTime / config.duration;\n\n    value = sanitizeVal(isCollapsedOrCollapsing(state.motion) ? 1 - value : value);\n\n    let result = {\n      elapsedTime,\n      prevValue: state.value,\n      value\n    };\n    return result;\n  };\n\n  let run = () => {\n    if (state.cancelled) return;\n\n    let { value, prevValue, elapsedTime } = getUpdate();\n\n    // update\n    state.value = value;\n    state.elapsedTime = elapsedTime;\n\n    if (elapsedTime >= config.duration) {\n      state.motion = isCollapsedOrCollapsing(state.motion) ? COLLAPSED : EXPANDED;\n      state.isRunning = false;\n      state.cAF = null;\n\n      if (prevValue !== value) onUpdate();\n\n      config.onDone && config.onDone({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\n    } else {\n      onUpdate();\n      state.cAF = rAF(run);\n    }\n  };\n\n  let toggle = () => {\n    if (config.duration <= 0) return;\n\n    state.cancelled = false;\n    state.isRunning = true;\n    state.hasReversed = isMoving(state.motion);\n    state.motion = isCollapsedOrCollapsing(state.motion) ? EXPANDING : COLLAPSING;\n\n    config.onToggle && config.onToggle({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\n\n    let now = getNow();\n\n    // update startTime\n    if (state.hasReversed) {\n      let { duration } = config;\n      let { startTime } = state;\n      let elapsedTime = Math.min(duration, now - startTime);\n      let subtract = Math.max(0, duration - elapsedTime);\n      state.startTime = now - subtract;\n    } else {\n      state.startTime = now;\n    }\n\n    onUpdate();\n    state.cAF = rAF(run);\n    return true;\n  };\n\n  let cancel = () => {\n    config.trace('cancel');\n\n    if (!state.isRunning) return;\n\n    state.cAF && cAF(state.cAF);\n\n    state.isRunning = false;\n\n    let motion = state.motion === EXPANDING ? COLLAPSED : EXPANDED;\n\n    state.motion = motion;\n    state.value = motion === COLLAPSED ? 0 : 1;\n    state.cancelled = true;\n\n    config.onCancel && config.onCancel({ value: state.value, motion: state.motion, hasReversed: state.hasReversed });\n    return true;\n  };\n\n  return { toggle, cancel };\n}\n\nexport default createToggle;\n"],"names":["root","window","global","rAF","requestAnimationFrame","bind","callback","setTimeout","cAF","cancelAnimationFrame","clearInterval","sanitizeVal","value","min","max","Math","clamp","round","COLLAPSED","EXPANDED","EXPANDING","COLLAPSING","getNow","Date","now","defaultParams","duration","trace","isMoving","motion","isCollapsedOrCollapsing","initiateStateAndConfig","params","config","cancelled","isRunning","startTime","state","onUpdate","run","elapsedTime","prevValue","getUpdate","onDone","hasReversed","toggle","onToggle","subtract","cancel","onCancel"],"mappings":"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"}